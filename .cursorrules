# Cursor Rules

## Diagrams

When making changes to database schema, import logic, or data flow:

- **Always update `backend/diagrams/er-diagram.md`** to reflect schema changes (tables, columns, relationships, constraints)
- **Always update `backend/diagrams/import-sequence.md`** when modifying the import/aggregation flow
- The ER diagram (`er-diagram.md`) is the source of truth for database structure
- Keep sequence diagrams synchronized with actual code flow in `backend/src/feed/import.ts`

## Database Schema

- Schema changes must be reflected in both `backend/src/db/schema.sql` AND `backend/diagrams/er-diagram.md`
- When adding/removing tables or columns, update both files
- When changing relationships or constraints, update the ER diagram

## Import Flow

- Changes to aggregation logic, yarn matching, or feed processing should be documented in `backend/diagrams/import-sequence.md`
- Keep sequence diagrams accurate to the actual code execution order

## Error Handling and Fallbacks

- **NEVER create fallback logic or default values** - it's better to throw an error
- If data is missing or invalid, throw an explicit error rather than using fallbacks, defaults, or empty arrays/objects
- Prefer `throw new Error()` over `return null`, `return []`, `return {}`, or `return defaultValue`
- Let errors bubble up rather than silently handling them with fallbacks
- The human is responsible for strategic decisions about error handling - don't add fallbacks "just in case"

## Backward Compatibility

- **NEVER maintain backward compatibility** unless explicitly requested
- When refactoring or changing APIs, update all call sites immediately
- Remove deprecated code, old interfaces, and legacy fields immediately
- Don't add compatibility layers, adapters, or migration helpers unless explicitly requested
- The human is responsible for strategic decisions about compatibility - don't maintain old patterns "for compatibility"